P8105\_hw6\_dm3175
================
Devon Morgan
11/20/2018

Homework 6 Solutions
====================

Homework 6 is focused on the topics included in the Linear Models module for p8105.

Problem 1
---------

The next problem explores data gathered by the Washington Post on homicides in 50 large US cities.

### Load and Clean the Data

Data was read in from a CSV posted on GitHub.

``` r
url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"
homicide_data = read_csv(url, na = "Unknown") %>% 
  janitor::clean_names() 
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_integer(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

Data cleaning steps were subsequently followed:

``` r
clean_homicide_data = homicide_data %>% 
  mutate(city_state = str_c(city, ", ", state),
         resolved = ifelse(disposition == "Closed by arrest", 1, 0),
         victim_race = ifelse(victim_race == "White", "white", "non-white"),
         victim_race = fct_relevel(victim_race, "white"),
         victim_age = as.numeric(victim_age)) %>% 
  filter(!(city_state == "Dallas, TX" | city_state == "Phoenix, AZ" | city_state == "Kansas City, MO" | city_state == "Tulsa, AL"))
```

Cleaning steps:

-   Created a `city_state` variable combining city and state.
-   Created a binary variable `resolved` indicating if crime was solved. "1" signifies solved ("Closed by arrest"), and "0" signifies unsolved "Closed without arrest" or "Open/No arrest".
-   Modified `victim_race` to have categories "white" and "non-white", with "white" as the reference category.
-   Converted `victim_age` to numeric.
-   Filtered out Dallas, TX, Phoenix, AZ and Kansas City, MO (incomplete data for variables of interest), and Tulsa, AL (data entry error).

### Fitting logistic regression model for Baltimore, MD

Focusing on homicide data from Baltimore, MD, a logistic regression model was fitted using `glm` function with resolved vs unresolved as the outcome and victim age, sex and race as predictors.

``` r
# fit logistic regression model on baltimore data
fit_logistic_balt = clean_homicide_data %>% 
  filter(city_state == "Baltimore, MD") %>% 
  select(victim_race, victim_age, victim_sex, resolved) %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial()) 

# tidy output for adjusted OR and confidence interval for solving homicides comparing non-white victims to white victims keeping all other variables fixed
fit_logistic_balt %>% 
broom::tidy() %>% 
  cbind(exp(confint(fit_logistic_balt))) %>% 
  mutate(OR = exp(estimate)) %>%
  filter(term == "victim_racenon-white") %>% 
  rename("conf_2.5" = "2.5 %", "conf_97.5" = "97.5 %") %>% 
  select(term, OR, conf_2.5, conf_97.5) %>% 
  knitr::kable(digits = 3)
```

    ## Waiting for profiling to be done...

| term                  |     OR|  conf\_2.5|  conf\_97.5|
|:----------------------|------:|----------:|-----------:|
| victim\_racenon-white |  0.441|      0.312|        0.62|

**Interpretation**: The table output represents the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed. The resulting odds ratio is less than 1, which indicates that the odds for having a homicide resolved in the non-white race victim group is lower than among whites. The results from this logistic regression model may therefore suggest that disparities exist in how likely a crime is to be resolved depending on the victims' race.

### Fitting logistic regression model for all cities

A logistic regression model was fitted for all cities using `map` and list columns. The stratified analysis allows for comparisons of adjusted odds ratios by each city to determine if differences in the estimates vary by city. As computed for the Baltimore data above, the model examines resolved vs unresolved crimes as the outcome and victim age, sex and race as predictors. The adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed was examined. When fitting this model, crime cases where victim sex and race were unknown were removed from the analysis.

``` r
# fitted logistic regression model by city_state
nest_fit_logistic_all = clean_homicide_data %>% 
  filter(!(victim_race == "NA" | victim_sex == "NA")) %>%
  group_by(city_state) %>%
  nest() %>%
  mutate(models = map(data, ~glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())),
         confid = map(models, broom::confint_tidy),
         models = map(models, broom::tidy)) %>% 
  select(-data) %>% 
  unnest() %>% 
# tidied the dataframe, including adding OR and CI estimate
  mutate(OR = exp(estimate),
         conf.low = exp(conf.low),
         conf.high = exp(conf.high), 
         log_OR = estimate) %>%
  filter(term == "victim_racenon-white") %>%
  select(city_state, term, OR, conf.low, conf.high)
```

#### Plot of estimated ORs and CIs for each city

The adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed was plotted for each city along with 95% confidence intervals. The resulting plot shows that OR values are generally less than 1 (except for Tampa, FL, Birmingham, AL and Durham, NC, although these estimates have large confidence intervals due to smaller sample sizes), indicating that homicides where the victim is nonwhite are generally less likely to be resolved than those when the victim is white. Note that the plot indicates that the value of the OR varies by City.

``` r
nest_fit_logistic_all %>%
  mutate(city_state = forcats::fct_reorder(city_state, desc(OR))) %>% 
  ggplot(aes(x = city_state, y = OR)) +
  geom_point() +
  geom_errorbar(aes(x = city_state, ymin = conf.low, ymax = conf.high)) +
  theme(axis.text.x = element_text(angle = 80, hjust = 1), text = element_text(size = 10)) +
  labs(title = "Adjusted OR for Solving Homicides of Non-White vs. White keeping Sex and Age Constant, by City",
         x = "City, State",
         y = "OR (95% CI)")
```

<img src="p8105_hw6_dm3175_files/figure-markdown_github/unnamed-chunk-5-1.png" width="90%" />

Problem 2
---------

This problem uses data gathered to understand the effects of several variables on a child's birthweight.

### Load and Tidy Data

``` r
birthweight_data = read_csv(file = "./data/birthweight.csv") %>% 
  janitor::clean_names()
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_integer(),
    ##   gaweeks = col_double(),
    ##   ppbmi = col_double(),
    ##   smoken = col_double()
    ## )

    ## See spec(...) for full column specifications.

``` r
birthweight_data %>% 
  skimr::skim()
```

    ## Skim summary statistics
    ##  n obs: 4342 
    ##  n variables: 20 
    ## 
    ## ── Variable type:integer ───────────────────────────────────────────────────────────────────────────────────────────
    ##  variable missing complete    n      mean      sd  p0  p25    p50  p75
    ##   babysex       0     4342 4342    1.49     0.5     1    1    1      2
    ##     bhead       0     4342 4342   33.65     1.62   21   33   34     35
    ##   blength       0     4342 4342   49.75     2.72   20   48   50     51
    ##       bwt       0     4342 4342 3114.4    512.15  595 2807 3132.5 3459
    ##     delwt       0     4342 4342  145.57    22.21   86  131  143    157
    ##   fincome       0     4342 4342   44.11    25.98    0   25   35     65
    ##     frace       0     4342 4342    1.66     0.85    1    1    2      2
    ##   malform       0     4342 4342    0.0035   0.059   0    0    0      0
    ##  menarche       0     4342 4342   12.51     1.48    0   12   12     13
    ##   mheight       0     4342 4342   63.49     2.66   48   62   63     65
    ##    momage       0     4342 4342   20.3      3.88   12   18   20     22
    ##     mrace       0     4342 4342    1.63     0.77    1    1    2      2
    ##    parity       0     4342 4342    0.0023   0.1     0    0    0      0
    ##   pnumlbw       0     4342 4342    0        0       0    0    0      0
    ##   pnumsga       0     4342 4342    0        0       0    0    0      0
    ##      ppwt       0     4342 4342  123.49    20.16   70  110  120    134
    ##    wtgain       0     4342 4342   22.08    10.94  -46   15   22     28
    ##  p100     hist
    ##     2 ▇▁▁▁▁▁▁▇
    ##    41 ▁▁▁▁▅▇▁▁
    ##    63 ▁▁▁▁▁▇▁▁
    ##  4791 ▁▁▁▃▇▇▂▁
    ##   334 ▁▇▅▁▁▁▁▁
    ##    96 ▁▂▇▂▂▂▁▃
    ##     8 ▇▇▁▁▁▁▁▁
    ##     1 ▇▁▁▁▁▁▁▁
    ##    19 ▁▁▁▁▂▇▁▁
    ##    77 ▁▁▁▅▇▂▁▁
    ##    44 ▂▇▅▂▁▁▁▁
    ##     4 ▇▁▇▁▁▁▁▁
    ##     6 ▇▁▁▁▁▁▁▁
    ##     0 ▁▁▁▇▁▁▁▁
    ##     0 ▁▁▁▇▁▁▁▁
    ##   287 ▁▇▆▁▁▁▁▁
    ##    89 ▁▁▁▇▇▁▁▁
    ## 
    ## ── Variable type:numeric ───────────────────────────────────────────────────────────────────────────────────────────
    ##  variable missing complete    n  mean   sd    p0   p25   p50   p75 p100
    ##   gaweeks       0     4342 4342 39.43 3.15 17.7  38.3  39.9  41.1  51.3
    ##     ppbmi       0     4342 4342 21.57 3.18 13.07 19.53 21.03 22.91 46.1
    ##    smoken       0     4342 4342  4.15 7.41  0     0     0     5    60  
    ##      hist
    ##  ▁▁▁▁▃▇▁▁
    ##  ▁▇▅▁▁▁▁▁
    ##  ▇▁▁▁▁▁▁▁

No missing values

The dataset contains the following variables (variable descriptions cited from Homework Assignment):

-   babysex: baby’s sex (male = 1, female = 2)
-   bhead: baby’s head circumference at birth (centimeters) blength: baby’s length at birth (centimeteres) bwt: baby’s birth weight (grams) delwt: mother’s weight at delivery (pounds) fincome: family monthly income (in hundreds, rounded) frace: father’s race (1= White, 2 = Black, 3 = Asian, 4 = Puerto Rican, 8 = Other, 9 = Unknown) gaweeks: gestational age in weeks malform: presence of malformations that could affect weight (0 = absent, 1 = present) menarche: mother’s age at menarche (years) mheigth: mother’s height (inches) momage: mother’s age at delivery (years) mrace: mother’s race (1= White, 2 = Black, 3 = Asian, 4 = Puerto Rican, 8 = Other) parity: number of live births prior to this pregnancy pnumlbw: previous number of low birth weight babies pnumgsa: number of prior small for gestational age babies ppbmi: mother’s pre-pregnancy BMI ppwt: mother’s pre-pregnancy weight (pounds) smoken: average number of cigarettes smoked per day during pregnancy wtgain: mother’s weight gain during pregnancy (pounds)
